"use strict";angular.module("lastfmApp",["ngResource","ngRoute","lastfmServices"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/search.html",controller:"SearchCtrl"}).when("/search/:artist/:page?",{templateUrl:"views/results.html",controller:"ResultsCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),angular.module("lastfmApp").controller("SearchCtrl",["$scope","$location",function(a,b){a.search=function(a){b.path("/search/"+a)}}]),angular.module("lastfmServices",["ngResource"]).factory("Artists",["$http","$q",function(a,b){var c=1;return c=1,{getArtists:function(c,d){return a.get("http://ws.audioscrobbler.com/2.0/",{params:{method:"artist.search",artist:c,api_key:"aceab0ee7a1b569b1cec10bac112a84e",page:d,limit:24,format:"json"}}).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})}}}]),angular.module("lastfmApp").controller("ResultsCtrl",["$scope","Artists","$routeParams",function(a,b,c){a.search=c.artist,a.resultMessage="Searching...",a.page=c.page||1,a.itemsPerPage=0,a.total=0,a.totalShown=0,a.showMore=!1,a.populating=!1,a.populate=function(d){console.log(d),a.populating||(a.populating=!0,b.getArtists(c.artist,d).then(function(b){var c=b.results.artistmatches.artist;a.artists=angular.isArray(c)?c:[c],a.total=Number(b.results["opensearch:totalResults"]),a.itemsPerPage=Number(b.results["opensearch:itemsPerPage"]),a.resultMessage=a.total+" matches were found",a.totalShown=a.page*a.itemsPerPage,a.populating=!1,a.rows=a.rows||[];for(var e=4,f=Math.round(a.itemsPerPage/e)*d,g=0,h=a.rows.length;f>h;h++)if(a.artists[g]){a.rows.push([]);for(var i=0;e>i;i++)a.artists[g]&&(a.rows[h][i]=a.artists[g],g++)}else g++;a.isShownMoreThanTotal()},function(a){console.log(a)}))},a.nextPage=function(){!a.populating&&a.showMore&&(a.page=Number(a.page)+1,a.populate(a.page))},a.isShownMoreThanTotal=function(){a.showMore=a.totalShown>=a.total?!1:!0},a.populate(a.page)}]),angular.module("lastfmApp").directive("infiniteScroll",["$window",function(a){return{link:function(b,c,d){var e,f;a=angular.element(a),console.log(b),a.bind("scroll",function(){f=a.height()+a.scrollTop(),e=c.offset().top+c.innerHeight(),f>=e&&b.$apply(d.infiniteScroll)})}}}]);